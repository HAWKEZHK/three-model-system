(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{119:function(e,t,n){var r=n(238);"string"==typeof r&&(r=[[e.i,r,""]]);var a={hmr:!0,transform:void 0,insertInto:void 0};n(16)(r,a);r.locals&&(e.exports=r.locals)},139:function(e,t,n){(t=e.exports=n(15)(!1)).push([e.i,".src-components-home-index-content{overflow:hidden;height:100vh;margin-right:300px;cursor:pointer}.src-components-home-index-content.src-components-home-index-close{margin-right:50px}.src-components-home-index-content .src-components-home-index-container{height:100%}.src-components-home-index-sider{overflow-x:hidden;overflow-y:auto;position:fixed;right:0;height:100vh}",""]),t.locals={content:"src-components-home-index-content",close:"src-components-home-index-close",container:"src-components-home-index-container",sider:"src-components-home-index-sider"}},19:function(e,t,n){var r=n(208);"string"==typeof r&&(r=[[e.i,r,""]]);var a={hmr:!0,transform:void 0,insertInto:void 0};n(16)(r,a);r.locals&&(e.exports=r.locals)},208:function(e,t,n){(t=e.exports=n(15)(!1)).push([e.i,".src-components-operation-index-container{padding:10px 10px 48px}.src-components-operation-index-container .src-components-operation-index-card{width:100%;margin-bottom:10px}.src-components-operation-index-container .src-components-operation-index-card .src-components-operation-index-gui{position:static}.src-components-operation-index-container .src-components-operation-index-card .src-components-operation-index-gui .cr input{width:25%!important;text-align:center}.src-components-operation-index-container .src-components-operation-index-card .src-components-operation-index-drawer-box{width:100%;padding:10px 0;background-color:#fafafa;border:1px dashed #d9d9d9;border-radius:4px;text-align:center;-webkit-transition:border-color .3s;transition:border-color .3s;cursor:pointer}.src-components-operation-index-container .src-components-operation-index-card .src-components-operation-index-drawer-box:hover{border-color:#40a9ff}.src-components-operation-index-container .src-components-operation-index-card .src-components-operation-index-drawer-box .src-components-operation-index-inbox{display:block;color:#40a9ff;font-size:30px}.src-components-operation-index-container .src-components-operation-index-card .src-components-operation-index-drawer-box .src-components-operation-index-tip{color:#666}.src-components-operation-index-container .src-components-operation-index-card .src-components-operation-index-drawer-box .src-components-operation-index-hint{font-size:12px;color:#999}.src-components-operation-index-container .src-components-operation-index-card .ant-card-head{background-color:#fafafa}.src-components-operation-index-container .src-components-operation-index-card .ant-card-body{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between}.src-components-operation-index-container .src-components-operation-index-card .ant-card-body .ant-tag-checkable{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.src-components-operation-index-modal{width:400px!important}.src-components-operation-index-modal .src-components-operation-index-modal-tip{display:block;margin-top:10px;font-size:12px}.src-components-operation-index-modal .src-components-operation-index-modal-tip i{margin-right:5px;color:#faad14}",""]),t.locals={container:"src-components-operation-index-container",card:"src-components-operation-index-card",gui:"src-components-operation-index-gui","drawer-box":"src-components-operation-index-drawer-box",inbox:"src-components-operation-index-inbox",tip:"src-components-operation-index-tip",hint:"src-components-operation-index-hint",modal:"src-components-operation-index-modal","modal-tip":"src-components-operation-index-modal-tip"}},238:function(e,t,n){(t=e.exports=n(15)(!1)).push([e.i,".src-components-three-drawer-index-drawer .ant-drawer-body{padding:0}",""]),t.locals={drawer:"src-components-three-drawer-index-drawer"}},247:function(e,t,n){"use strict";n.r(t);function b(e){return new g.Mesh(e,new g.MeshLambertMaterial({color:S,opacity:.5,transparent:!0}))}function T(e,t){void 0===t&&(t=j[e]);var n=new g.Geometry;switch(e){case"BoxGeometry":var r=t,a=r.width,o=r.height,i=r.depth;n=new g.BoxGeometry(a,o,i);break;case"SphereGeometry":var s=t,c=s.radius,p=s.widthSegments,l=s.heightSegments;n=new g.SphereGeometry(c,p,l);break;case"CylinderGeometry":var d=t,m=d.radiusTop,h=d.radiusBottom,u=(o=d.height,d.radiusSegments);n=new g.CylinderGeometry(m,h,o,u);break;case"TorusGeometry":var f=t,x=(c=f.radius,f.tube),y=f.radialSegments,T=f.tubularSegments;n=new g.TorusGeometry(c,x,y,T)}return b(n)}function r(e,t){var n=document.createElement("a");n.style.display="none",document.body.appendChild(n),n.href=URL.createObjectURL(new Blob([e],{type:"text/plain"})),n.download=t,n.click()}var a=n(1),w=n.n(a),o=n(7),i=n.n(o),s=(n(131),n(53)),p=(n(136),n(54)),c=n(61),g=n(9),l=n(107),d=n.n(l),m=n(108),h=n.n(m),u=n(109),f=n.n(u),x=n(124),v=1200,E=60,S="#ff0000",k=45,C=50,P=4e3,M={x:1e3,y:1e3,z:1e3},z={x:0,y:0,z:0},L=[{name:"立方体",type:"BoxGeometry"},{name:"球体",type:"SphereGeometry"},{name:"柱体",type:"CylinderGeometry"},{name:"环",type:"TorusGeometry"}],R={x:0,y:0,z:0},j={DEFAULT:{width:0,height:0,depth:0},BoxGeometry:{width:E,height:E,depth:E},SphereGeometry:{radius:30,widthSegments:E,heightSegments:E},CylinderGeometry:{radiusTop:30,radiusBottom:30,height:E,radiusSegments:E},TorusGeometry:{radius:30,tube:15,radialSegments:E,tubularSegments:E}},N=["OBJ","STL"],y=[{type:"OBJ",items:["鹿"]},{type:"OBJ-MTL",items:["车"]},{type:"STL",items:["螺丝","螺母"]}],O="DRAFT_ENTITIES",G=n(51),V=n.n(G),I=p.a.Content,B=p.a.Sider,D=function(t){function e(e){var y=t.call(this,e)||this;return y.setDraft=function(){var t=new g.ObjectLoader,e=localStorage.getItem(O);if(e){var n;try{n=JSON.parse(e)}catch(e){n=null}n&&n.forEach(function(e){return y.addEntity(t.parse(e))}),y.renderThree()}},y.bindActions=function(){var e=y.stageRef.current;e&&(window.onbeforeunload=function(){1<y.entities.length&&(y.entities.shift(),localStorage.setItem(O,JSON.stringify(y.entities)))},window.onresize=y.handleResize,e.onmousemove=y.handleMouseMove,e.onmouseup=y.handleMouseUp,e.ondblclick=y.handledbClick)},y.handleResize=function(){var e=y.stageRef.current;if(e){var t=e.offsetWidth,n=e.offsetHeight;y.renderer.setSize(t,n),y.camera.aspect=t/n,y.camera.updateProjectionMatrix()}},y.handleMouseMove=function(e){var t=e.clientX,n=e.clientY,r=y.state.changeType;if(y.preThree&&"pos"===r){var a=y.getIntersect(t,n);if(a){var o=a.point,i=a.face;y.update("pos",o.clone().add(i?i.normal:new g.Vector3(0,1,0)).divideScalar(E).floor().multiplyScalar(E).addScalar(30))}}},y.handleMouseUp=function(e){var t=e.button,n=y.state.changeType;y.preThree&&(0===t&&"pos"===n&&y.setState({changeType:"rotate"},y.renderThree),2===t&&y.setPreThree(null))},y.handledbClick=function(e){var t=e.clientX,n=e.clientY;if(!y.preThree){var r=y.getIntersect(t,n);if(r){var a=r.object,o=y.entities.indexOf(a);if(0!==o){y.entities.splice(o,1),y.scene.remove(a);var i,s=a,c=s.geometry,p=s.position,l=s.rotation,d=c.type,m=c.parameters,h={x:180*l.x/Math.PI,y:180*l.y/Math.PI,z:180*l.z/Math.PI},u={};L.map(function(e){return e.type}).includes(d)?(i=d,Object.keys(j[i]).forEach(function(e){return u[e]=m[e]})):(i="External",u=j.DEFAULT),y.preThree=b(c),y.preThree.position.copy(p),y.preThree.rotation.copy(l),y.scene.add(y.preThree),y.setState({preType:i,prePos:p,preRotate:h,preParams:u},y.renderThree)}}}},y.renderThree=function(){var e=y.state.changeType;y.preThree?(y.scene.add(y.transformControls),"rotate"===e?y.transformControls.attach(y.preThree):y.transformControls.detach(y.preThree)):y.scene.remove(y.transformControls),y.renderer.render(y.scene,y.camera)},y.initThree=function(){var e=y.stageRef.current;if(e){var t=e.offsetWidth,n=e.offsetHeight;y.initCamera(t/n),y.initOrbitControls(),y.initTransformControls(),y.renderer.setSize(t,n),y.initLight(),y.initAxis(),y.initGridding(),y.renderThree(),e.appendChild(y.renderer.domElement)}},y.initCamera=function(e){var t=k,n=C,r=P,a=M,o=z;y.camera=new g.PerspectiveCamera(t,e,n,r),y.camera.position.set(a.x,a.y,a.z),y.camera.lookAt(new g.Vector3(o.x,o.y,o.z))},y.initLight=function(){var e=new g.DirectionalLight("#fff");e.position.set(4,3,2).normalize(),y.scene.add(new g.AmbientLight("#606060"),e)},y.initAxis=function(){return y.scene.add(new g.ArrowHelper(new g.Vector3(v,0,0),new g.Vector3(-v,0,0),2*v,16711680,E),new g.ArrowHelper(new g.Vector3(0,v,0),new g.Vector3(0,-v,0),2*v,65280,E),new g.ArrowHelper(new g.Vector3(0,0,v),new g.Vector3(0,0,-v),2*v,255,E))},y.initGridding=function(){for(var e=new g.Geometry,t=-v;t<=v;t+=E)e.vertices.push(new g.Vector3(-v,0,t),new g.Vector3(v,0,t),new g.Vector3(t,0,-v),new g.Vector3(t,0,v));y.scene.add(new g.LineSegments(e,new g.LineBasicMaterial({color:"#000",opacity:.1,transparent:!0}))),y.addEntity(new g.Mesh(new g.PlaneBufferGeometry(2*v,2*v).rotateX(-Math.PI/2),new g.MeshLambertMaterial({visible:!1})))},y.initOrbitControls=function(){y.orbitControls=new d.a(y.camera,y.renderer.domElement),y.orbitControls.maxDistance=2*v,y.orbitControls.minDistance=120;var t=y.stageRef.current;t&&(y.orbitControls.addEventListener("change",function(){var e=y.state.changeType;t.onmouseup=null,y.preThree&&"pos"===e&&(y.preThree.visible=!1),y.renderThree()}),y.orbitControls.addEventListener("end",function(){t.onmouseup=y.handleMouseUp,y.preThree&&(y.preThree.visible=!0),y.renderThree()}))},y.initTransformControls=function(){y.transformControls=new h.a(y.camera,y.renderer.domElement),y.transformControls.setSize(.5),y.transformControls.setMode("rotate"),y.transformControls.addEventListener("objectChange",function(e){var t=e.target,n=t.getMode,r=t.object.rotation;if("rotate"===n()){var a=180*r.x/Math.PI,o=180*r.y/Math.PI,i=180*r.z/Math.PI;y.setState({preRotate:{x:a,y:o,z:i}},y.renderThree)}})},y.getIntersect=function(e,t){var n=y.stageRef.current;if(n){var r=n.offsetWidth,a=n.offsetHeight;return y.raycaster.setFromCamera(new g.Vector2(-(r/2-e)/(r/2),(a/2-t)/(a/2)),y.camera),y.raycaster.intersectObjects(y.entities)[0]}},y.setPreThree=function(e,t){y.preThree&&y.scene.remove(y.preThree);var n=j.DEFAULT;switch(e){case null:y.preThree=null;break;case"External":if(!t)return;y.preThree=t,y.scene.add(y.preThree);break;default:n=j[e],y.preThree=T(e),y.scene.add(y.preThree)}y.setState({preType:e,prePos:R,preRotate:R,preParams:n,changeType:"pos"},y.renderThree)},y.update=function(e,t){if(y.preThree)switch(e){case"pos":var n=t,r=n.x,a=n.y,o=n.z;y.preThree.position.set(r,a,o),y.setState({changeType:e,prePos:{x:r,y:a,z:o}},y.renderThree);break;case"rotate":var i=t,s=[r=i.x,a=i.y,o=i.z].map(function(e){return e*Math.PI/180}),c=s[0],p=s[1],l=s[2];y.preThree.rotation.set(c,p,l),y.setState({changeType:e,preRotate:{x:r,y:a,z:o}},y.renderThree);break;case"params":var d=t,m=y.state,h=m.preType,u=m.prePos,f=m.preRotate;if(!h)return;if("External"===h)return void y.externalTip();y.scene.remove(y.preThree),y.preThree=T(h,d);var x=[f.x,f.y,f.z].map(function(e){return e*Math.PI/180});c=x[0],p=x[1],l=x[2];y.preThree.position.set(u.x,u.y,u.z),y.preThree.rotation.set(c,p,l),y.scene.add(y.preThree),y.setState({changeType:e,preParams:d},y.renderThree)}else y.noSelTip()},y.confirm=function(e){if(y.preThree){var t=y.state.changeType;switch(e){case"pos":case"rotate":y.setState({changeType:t===e?null:e},y.renderThree);break;case"params":var n=y.preThree.clone();"Mesh"===n.type?(n.material=new g.MeshLambertMaterial({color:S}),y.addEntity(n)):n.children.forEach(function(e){e.position.copy(n.position),y.addEntity(e.clone())}),y.preThree.position.add(new g.Vector3(E,0,0)),y.setState({changeType:"pos"},y.renderThree)}}else y.noSelTip()},y.downloadFile=function(e){if(y.entities.length<=1)s.a.warning("场景中未找到几何体~");else switch(y.setPreThree(null),e){case"OBJ":var t=new f.a,n=new g.Scene;y.entities.forEach(function(e,t){0!==t&&n.add(e.clone())}),r(t.parse(n),"THREE-OBJ.obj");break;case"STL":y.entities.forEach(function(e,t){0!==t&&r(x.a(e),"THREE-STL-"+t+".stl")})}},y.cleanScene=function(){y.entities.forEach(function(e,t){0!==t&&y.scene.remove(e)}),y.entities.length=1,localStorage.removeItem(O),y.renderThree(),s.a.success("清空完毕")},y.addEntity=function(e){y.scene.add(e),y.entities.push(e)},y.noSelTip=function(){document.body.querySelector(".ant-message-notice")||s.a.warning("还未选择几何体"),y.setState({prePos:R,preRotate:R,preParams:j.DEFAULT,changeType:null})},y.externalTip=function(){document.body.querySelector(".ant-message-notice")||s.a.warning("不支持修改外部模型参数"),y.setState({preParams:j.DEFAULT})},y.state={collapsed:!1,drawerVisible:!1,preType:null,prePos:R,preRotate:R,preParams:j.DEFAULT,changeType:null},y.stageRef=Object(a.createRef)(),y.scene=new g.Scene,y.camera=new g.PerspectiveCamera,y.renderer=new g.WebGLRenderer({antialias:!0,alpha:!0}),y.raycaster=new g.Raycaster,y.orbitControls=null,y.transformControls=null,y.entities=[],y.preThree=null,y}return c.a(e,t),e.prototype.componentDidMount=function(){this.initThree(),this.setDraft(),this.bindActions()},e.prototype.render=function(){var t=this,e=this.state,n=e.collapsed,r=e.drawerVisible,a=e.preType,o=e.prePos,i=e.preRotate,s=e.preParams,c=e.changeType;return w.a.createElement(p.a,null,w.a.createElement(p.a,null,w.a.createElement(I,{className:V.a.content+(n?" "+V.a.close:"")},w.a.createElement("div",{className:V.a.container,ref:this.stageRef}))),w.a.createElement(B,{className:V.a.sider,width:"300",collapsedWidth:"40",collapsible:!0,reverseArrow:!0,collapsed:n,onCollapse:function(e){return t.setState({collapsed:e},t.handleResize)}},!n&&w.a.createElement($,{preType:a,prePos:o,preRotate:i,preParams:s,changeType:c,setPreThree:this.setPreThree,update:this.update,confirm:this.confirm,downloadFile:this.downloadFile,openDrawer:function(){return t.setState({drawerVisible:!0})},cleanScene:this.cleanScene,entityNum:this.entities.length})),w.a.createElement(le,{visible:r,closeDrawer:function(){return t.setState({drawerVisible:!1})},addToPreThree:function(e){return t.setPreThree("External",e)}}))},e}(a.Component),A=(n(187),n(121)),F=(n(248),n(46)),J=(n(250),n(116)),U=(n(101),n(12)),H=(n(202),n(85)),W=(n(205),n(123)),X=n(52),q=n.n(X),Y=n(19),K=n.n(Y),_=(n(209),X.DatNumber),Q=W.a.CheckableTag,Z=H.a.Group,$=function(n){function e(e){var t=n.call(this,e)||this;return t.saveFile=function(){var e=t.state.fileType;(0,t.props.downloadFile)(e),t.setState({modalVisible:!1})},t.state={fileType:N[0],modalVisible:!1},t}return c.a(e,n),e.prototype.render=function(){var n=this,e=this.state,t=e.fileType,r=e.modalVisible,a=this.props,o=a.preType,i=a.prePos,s=a.preRotate,c=a.preParams,p=a.changeType,l=a.setPreThree,d=a.update,m=a.confirm,h=a.openDrawer,u=a.cleanScene,f=a.entityNum,x=L.filter(function(e){return e.type===o})[0],y=x?x.name:"未选中几何体";return w.a.createElement(w.a.Fragment,null,w.a.createElement("div",{className:K.a.container},w.a.createElement(F.a,{className:K.a.card,size:"small",bordered:!1,title:"基础几何体",extra:w.a.createElement(J.a,{title:"确定清空所有内容吗？",okText:"确定",cancelText:"取消",placement:"leftTop",onConfirm:u},w.a.createElement("a",{href:"javascript:;"},w.a.createElement(U.a,{type:"delete",theme:"twoTone"})))},L.map(function(e){var t=e.name,n=e.type;return w.a.createElement(Q,{key:n,checked:n===o,onChange:function(){return n!==o&&l(n)}},t)})),w.a.createElement(F.a,{className:K.a.card,size:"small",bordered:!1,title:"位置信息-"+y,extra:w.a.createElement("a",{href:"javascript:;",onClick:function(){return m("pos")}},w.a.createElement(U.a,{type:"pos"===p?"unlock":"lock",theme:"twoTone"}))},w.a.createElement(q.a,{className:K.a.gui,data:i,onUpdate:function(e){return d("pos",e)}},Object.keys(i).map(function(e){return w.a.createElement(_,{key:e,path:e,label:e,min:-v,max:v,step:1})}))),w.a.createElement(F.a,{className:K.a.card,size:"small",bordered:!1,title:"旋转信息(度)-"+y,extra:w.a.createElement("a",{href:"javascript:;",onClick:function(){return m("rotate")}},w.a.createElement(U.a,{type:"rotate"===p?"unlock":"lock",theme:"twoTone"}))},w.a.createElement(q.a,{className:K.a.gui,data:s,onUpdate:function(e){return d("rotate",e)}},Object.keys(s).map(function(e){return w.a.createElement(_,{key:e,path:e,label:e,min:-180,max:180,step:1})}))),w.a.createElement(F.a,{className:K.a.card,size:"small",bordered:!1,title:"几何信息-"+y,extra:w.a.createElement("a",{href:"javascript:;",onClick:function(){return m("params")}},"保存")},w.a.createElement(q.a,{className:K.a.gui,data:c,onUpdate:function(e){return d("params",e)}},Object.keys(c).map(function(e){return e.includes("Segments")?w.a.createElement(_,{key:e,path:e,label:e.replace("Segments","Seg"),min:3,max:120,step:1}):w.a.createElement(_,{key:e,path:e,label:e,min:0,max:v,step:1})}))),w.a.createElement(F.a,{className:K.a.card,size:"small",bordered:!1,title:"文件操作",extra:w.a.createElement("a",{href:"javascript:;",onClick:function(){return n.setState({modalVisible:!0})}},"下载文件")},w.a.createElement("div",{className:K.a["drawer-box"],onClick:h},w.a.createElement(U.a,{className:K.a.inbox,type:"inbox"}),w.a.createElement("div",{className:K.a.tip},"从3D库中添加模型"),w.a.createElement("div",{className:K.a.hint},"支持 obj + mtl / stl")))),w.a.createElement(A.a,{className:K.a.modal,title:"选择文件类型",okText:"确认",cancelText:"取消",closable:!1,visible:r,onOk:this.saveFile,onCancel:function(){return n.setState({modalVisible:!1})}},w.a.createElement(Z,{value:t,onChange:function(e){var t=e.target.value;return n.setState({fileType:t})}},N.map(function(e){return w.a.createElement(H.a,{value:e,key:e},e)})),"OBJ"!==t&&4<f&&w.a.createElement("span",{className:K.a["modal-tip"]},w.a.createElement(U.a,{type:"exclamation-circle"}),"检测到几何体较多，建议使用 OBJ 格式保存")))},e}(a.Component),ee=(n(231),n(122)),te=(n(249),n(69)),ne=n(84),re=n(118),ae=n.n(re),oe=n(119),ie=n.n(oe),se=te.a.SubMenu,ce=ne.OBJLoader,pe=ne.MTLLoader,le=function(e){var t=e.visible,s=e.closeDrawer,c=e.addToPreThree;return w.a.createElement(ee.a,{title:w.a.createElement(w.a.Fragment,null,w.a.createElement(U.a,{type:"tool"})," 3D 文件库"),placement:"left",className:ie.a.drawer,closable:!1,visible:t,onClose:s},w.a.createElement(te.a,{mode:"inline",theme:"light",defaultOpenKeys:y.map(function(e){return e.type}),onClick:function(e){var t=e.keyPath,n=t[0],r=t[1],a="src/static/3d-files/"+r+"/"+n;switch(r){case"OBJ":(new ce).load(a+".obj",function(e){c(e),s()});break;case"OBJ-MTL":var o=[new ce,new pe],i=o[0];o[1].load(a+"/"+n+".mtl",function(e){e.preload(),i.setMaterials(e),i.load(a+"/"+n+".obj",function(e){c(e),s()})});break;case"STL":(new(ae()(g))).load(a+".stl",function(e){c(b(e)),s()})}}},y.map(function(e){var t=e.type,n=e.items;return w.a.createElement(se,{key:t,title:t+" 文件"},n.map(function(e){return w.a.createElement(te.a.Item,{key:e},e)}))})))};i.a.render(w.a.createElement(D,null),document.getElementById("root"))},51:function(e,t,n){var r=n(139);"string"==typeof r&&(r=[[e.i,r,""]]);var a={hmr:!0,transform:void 0,insertInto:void 0};n(16)(r,a);r.locals&&(e.exports=r.locals)}},[[247,1,2]]]);